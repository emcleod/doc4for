<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if is_index %}Module Index{% else %}{{ module_data.module_name }}{% endif %}</title>
  <link rel="stylesheet" href="../static/css/styles.css">
</head>

<body>
  <nav>
    <div class="menu-toggle">&#9776;</div>
    <ul class="menu">
      <li><a href="../index.html">File View</a></li>
      <li><a href="module_index.html">Module View</a></li>
    </ul>
  </nav>

  <main>
    <aside class="sidebar">
      <nav>
        <ul>
          {% for module_name in module_names %}
          <li><a href="{{ module_name }}.html">{{ module_name }}</a></li>
          {% endfor %}
        </ul>
      </nav>
    </aside>

    <article class="content">
      {% if is_index %}
      <h1>Module Index</h1>
      <p>{{ content_data }}</p>
      {% else %}
      <h1>Module {{ module_data.module_name }}</h1>
      <p class="file-name">Defined in:
        <a href="../{{ module_data.file_name.split('.')[0] }}.html">{{ module_data.file_name }}</a>
      </p>

      <section class="module-description">
        {% if module_data.derived_types %}
          {% for derived_type_name, derived_type_data in module_data.derived_types.items() %}
            {% if derived_type_data.parent_module %}
              <p class="derived-from">Derived from: {{ derived_type_data.parent_module }}</p>
            {% endif %}
          {% endfor %}
        {% endif %}
        <p>{{ module_data.module_description }}</p>
      </section>

      <section class="constants-summary">
        <h2>Constants</h2>
        {% if module_data.constants %}
        <ul>
          {% for constant_name, constant_value in module_data.constants.items() %}
          <li><strong>{{ constant_name }}</strong>: {{ constant_value }}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </section>

      <section class="subroutines-summary">
        <h2>Subroutines</h2>
        {% if module_data.subroutines %}
        <ul>
          {% for subroutine_name, subroutine_details in module_data.subroutines.items() %}
          <li><strong>{{ subroutine_name }}</strong></li>
          {% endfor %}
        </ul>
        {% endif %}
      </section>

      <section class="functions-summary">
        <h2>Functions</h2>
        {% if module_data.functions %}
        <table>
          <thead>
            <tr>
              <th>Attributes</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            {% for function_name, function_data in module_data.functions.items() %}
            <tr>
              <td>{{ function_data.details.attributes | join(', ') }}</td>
              <td>
                <strong><a href="#function-{{ function_name }}">{{ function_name }}</a></strong>
                <br>
                <span class="function-description">{{ function_data.details.description }}</span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% endif %}
      </section>

      <section class="function-details" aria-labelledby="function-details-heading">
        <h2 id="function-details-heading">Function Details</h2>
        {% for function_name, function_data in module_data.functions.items() %}
        <section class="function" id="function-{{ function_name }}" aria-labelledby="{{ function_name }}-heading">
          <h3 id="{{ function_name }}-heading" class="function-header">
            {%- if function_data.details.attributes -%}
            <span class="function-attributes">{{ function_data.details.attributes|join(' ') }}</span>
            {%- endif -%}
            <span class="function-name">{{ function_name }}</span>
          </h3>
          <div class="function-body">
            {% if function_data.details %}
            <p>{{ function_data.details.description }}</p>
            {% if function_data.details.in %}
            <!--TODO  think about changing this to
              Arguments:
                 in: arg1: real - description
                 out: arg2: integer - description
                 return: res: real - description
            -->
            <!--TODO only display if there are values -->
            <!-- TODO this should use input and output -->
            <p><strong>Inputs:</strong></p>
            <ul class="function-args">
              {% for arg_name, arg_details in function_data.details.in.items() %}
              <li><span class="arg-name">{{ arg_name }}: {{ arg_details.type }}</span>
                {% if arg_details.dimension %}({{ arg_details.dimension }}){% endif %}
                - {{ arg_details.description }}</li> <!--TODO remove dash if no description -->
              {% endfor %}
            </ul>
            {% endif %}
            {% if function_data.details.return %}
            <p><strong>Returns:</strong></p>
            <ul class="function-args">
              {% for return_name, return_details in function_data.details.return.items() %}
              <li><span class="arg-name">{{ return_name }}: {{ return_details.type }}</span>
                {% if return_details.dimension %}({{ return_details.dimension }}){% endif %}
                - {{ return_details.description }}</li><!--TODO remove dash if no description -->
              {% endfor %}
            </ul>
            {% endif %}
            {% else %}
            <p>No detailed information available for this function.</p>
            {% endif %}
          </div>
        </section>
        {% endfor %}
      </section>
      {% endif %}
    </article>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const menuToggle = document.querySelector('.menu-toggle');
      const menu = document.querySelector('.menu');
      const menuItems = document.querySelectorAll('.menu a');

      // Toggle menu when hamburger icon is clicked
      menuToggle.addEventListener('click', () => {
        menu.classList.toggle('active');
      });

      // Close menu when a menu item is clicked
      menuItems.forEach(item => {
        item.addEventListener('click', (event) => {
          event.stopPropagation(); // Prevent event from bubbling up to document
          menu.classList.remove('active');
        });
      });

      // Close menu when clicking outside
      document.addEventListener('click', (event) => {
        if (!event.target.closest('.menu') && !event.target.closest('.menu-toggle')) {
          menu.classList.remove('active');
        }
      });
    });
  </script>
</body>

</html>